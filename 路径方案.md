# Cline é¡¹ç›®å·¥ä½œåŒºè·¯å¾„ç®¡ç†æ–¹æ¡ˆ

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Cline é¡¹ç›®å¦‚ä½•è§£å†³å’Œä¼ é€’å·¥ä½œåŒºæ–‡ä»¶è·¯å¾„é—®é¢˜ã€‚

## ç›®å½•

- [1. è·¯å¾„è·å–æœºåˆ¶](#1-è·¯å¾„è·å–æœºåˆ¶)
- [2. è·¯å¾„ä¼ é€’æœºåˆ¶](#2-è·¯å¾„ä¼ é€’æœºåˆ¶)
- [3. Webview å’Œ Extension çš„è·¯å¾„åŒæ­¥](#3-webview-å’Œ-extension-çš„è·¯å¾„åŒæ­¥)
- [4. å…³é”®è®¾è®¡ç‰¹ç‚¹](#4-å…³é”®è®¾è®¡ç‰¹ç‚¹)
- [5. æ•°æ®æµå‘](#5-æ•°æ®æµå‘)

---

## 1. è·¯å¾„è·å–æœºåˆ¶

### 1.1 æ ¸å¿ƒå·¥å…·å‡½æ•° (`src/utils/path.ts`)

Cline æä¾›äº†ä¸€ç³»åˆ—å·¥å…·å‡½æ•°æ¥å¤„ç†å·¥ä½œåŒºè·¯å¾„:

#### ä¸»è¦å‡½æ•°

- **`getCwd(defaultCwd = "")`**: è·å–ç¬¬ä¸€ä¸ªå·¥ä½œåŒºè·¯å¾„
  - é€šè¿‡ `HostProvider.workspace.getWorkspacePaths()` è·å–æ‰€æœ‰å·¥ä½œåŒºè·¯å¾„
  - è¿”å›ç¬¬ä¸€ä¸ªè·¯å¾„æˆ–é»˜è®¤è·¯å¾„

- **`getWorkspacePath(defaultCwd = "")`**: è·å–å½“å‰ç¼–è¾‘å™¨æ–‡ä»¶æ‰€åœ¨çš„å·¥ä½œåŒºè·¯å¾„
  - é¦–å…ˆè·å–å½“å‰æ´»åŠ¨ç¼–è¾‘å™¨çš„æ–‡ä»¶è·¯å¾„
  - éå†æ‰€æœ‰å·¥ä½œåŒº,æ‰¾åˆ°åŒ…å«è¯¥æ–‡ä»¶çš„å·¥ä½œåŒº
  - å¦‚æœæ²¡æœ‰æ‰“å¼€æ–‡ä»¶,åˆ™è¿”å›ç¬¬ä¸€ä¸ªå·¥ä½œåŒºè·¯å¾„

- **`getReadablePath(cwd, relPath)`**: å°†ç»å¯¹è·¯å¾„è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„ç”¨äºå±•ç¤º
  - å·¥ä½œåŒºå†…çš„æ–‡ä»¶æ˜¾ç¤ºç›¸å¯¹è·¯å¾„ (å¦‚ `src/file.ts`)
  - å·¥ä½œåŒºå¤–çš„æ–‡ä»¶æ˜¾ç¤ºç»å¯¹è·¯å¾„
  - å½“å‰å·¥ä½œåŒºæ ¹ç›®å½•æ˜¾ç¤º basename

#### è·¨å¹³å°è·¯å¾„å¤„ç†

```typescript
// ç»Ÿä¸€è½¬æ¢ä¸ºæ­£æ–œæ æ ¼å¼å±•ç¤ºç»™ AI å’Œç”¨æˆ·
String.prototype.toPosix = function (this: string): string {
  return this.replace(/\\/g, "/")
}

// å®‰å…¨çš„è·¯å¾„æ¯”è¾ƒ(Windows ä¸åŒºåˆ†å¤§å°å†™)
export function arePathsEqual(path1?: string, path2?: string): boolean {
  if (process.platform === "win32") {
    return path1.toLowerCase() === path2.toLowerCase()
  }
  return path1 === path2
}
```

**è®¾è®¡ç†å¿µ:**
1. å‘ AI å’Œç”¨æˆ·å±•ç¤ºæ—¶ç»Ÿä¸€ä½¿ç”¨æ­£æ–œæ  `/`
2. ä½¿ç”¨ `arePathsEqual()` è¿›è¡Œå®‰å…¨çš„è·¯å¾„æ¯”è¾ƒ
3. å†…éƒ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œä½¿ç”¨ Node.js åŸç”Ÿ path æ¨¡å—

### 1.2 å¤šå·¥ä½œåŒºç®¡ç† (`WorkspaceRootManager`)

`WorkspaceRootManager` ç±»è´Ÿè´£ç®¡ç†å¤šä¸ªå·¥ä½œåŒºæ ¹ç›®å½•:

```typescript
class WorkspaceRootManager {
  private roots: WorkspaceRoot[]  // æ‰€æœ‰å·¥ä½œåŒºæ ¹ç›®å½•
  private primaryIndex: number    // ä¸»å·¥ä½œåŒºç´¢å¼•
  
  // æ ¸å¿ƒæ–¹æ³•
  getPrimaryRoot(): WorkspaceRoot | undefined
  resolvePathToRoot(absolutePath: string): WorkspaceRoot | undefined
  getRelativePathFromRoot(absolutePath: string, root?: WorkspaceRoot): string | undefined
  getRoots(): WorkspaceRoot[]
  getRootByName(name: string): WorkspaceRoot | undefined
  isPathInWorkspace(absolutePath: string): boolean
}
```

#### WorkspaceRoot æ•°æ®ç»“æ„

```typescript
interface WorkspaceRoot {
  path: string           // å·¥ä½œåŒºç»å¯¹è·¯å¾„
  name?: string          // å·¥ä½œåŒºæ˜¾ç¤ºåç§°
  vcs: VcsType           // ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç±»å‹ (Git/Mercurial/None)
  commitHash?: string    // æœ€æ–° Git commit hash
}
```

#### å…³é”®åŠŸèƒ½

1. **VCS æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹å·¥ä½œåŒºçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç±»å‹
2. **è·¯å¾„è§£æ**: æ ¹æ®ç»å¯¹è·¯å¾„æ‰¾åˆ°æ‰€å±çš„å·¥ä½œåŒº
3. **å¤šå·¥ä½œåŒºæ”¯æŒ**: æ”¯æŒ VSCode å¤šæ ¹å·¥ä½œåŒº
4. **ç¯å¢ƒè¯¦æƒ…ç”Ÿæˆ**: ç”ŸæˆåŒ…å« Git ä¿¡æ¯çš„å·¥ä½œåŒºé…ç½®

---

## 2. è·¯å¾„ä¼ é€’æœºåˆ¶

### 2.1 Controller å±‚åˆå§‹åŒ–

`Controller` ç±»åœ¨åˆå§‹åŒ–ä»»åŠ¡æ—¶è®¾ç½®å·¥ä½œåŒºç®¡ç†å™¨:

```typescript
class Controller {
  private workspaceManager?: WorkspaceRootManager
  
  async initTask(
    task?: string,
    images?: string[],
    files?: string[],
    historyItem?: HistoryItem,
    taskSettings?: Partial<Settings>,
  ) {
    // 1. åˆå§‹åŒ–å·¥ä½œåŒºç®¡ç†å™¨
    this.workspaceManager = await setupWorkspaceManager({
      stateManager: this.stateManager,
      detectRoots: detectWorkspaceRoots,
    })
    
    // 2. è·å–ä¸»å·¥ä½œåŒºè·¯å¾„ä½œä¸º cwd
    const cwd = this.workspaceManager?.getPrimaryRoot()?.path 
                || (await getCwd(getDesktopDir()))
    
    // 3. ä¼ é€’ç»™ Task
    this.task = new Task({
      cwd,
      workspaceManager: this.workspaceManager,
      // ... å…¶ä»–å‚æ•°
    })
  }
}
```

#### åˆå§‹åŒ–æµç¨‹

1. **æ£€æµ‹å·¥ä½œåŒº**: é€šè¿‡ `detectWorkspaceRoots()` æ£€æµ‹æ‰€æœ‰å·¥ä½œåŒº
2. **åˆ›å»ºç®¡ç†å™¨**: åˆ›å»º `WorkspaceRootManager` å®ä¾‹
3. **è·å–ä¸»è·¯å¾„**: è·å–ä¸»å·¥ä½œåŒºè·¯å¾„ä½œä¸º `cwd`
4. **ä¼ é€’ç»™ Task**: å°† `cwd` å’Œ `workspaceManager` ä¼ é€’ç»™ Task å®ä¾‹

### 2.2 Task å±‚ä½¿ç”¨

Task æ¥æ”¶å·¥ä½œåŒºä¿¡æ¯å¹¶ç”¨äºæ‰€æœ‰æ–‡ä»¶æ“ä½œ:

```typescript
class Task {
  private cwd: string
  private workspaceManager?: WorkspaceRootManager
  
  constructor(config: TaskConfig) {
    this.cwd = config.cwd
    this.workspaceManager = config.workspaceManager
  }
  
  // æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½åŸºäº cwd è¿›è¡Œç›¸å¯¹è·¯å¾„è§£æ
  async readFile(relPath: string) {
    const absolutePath = workspaceResolver.resolveWorkspacePath(
      this.cwd, 
      relPath, 
      "Task.readFile"
    )
    // ... æ–‡ä»¶æ“ä½œ
  }
}
```

#### è·¯å¾„è§£æç­–ç•¥

- ä½¿ç”¨ `workspaceResolver.resolveWorkspacePath(cwd, relPath)` è§£æç›¸å¯¹è·¯å¾„
- æ”¯æŒè·¨å·¥ä½œåŒºè·¯å¾„è§£æ (é€šè¿‡ `workspaceHint`)
- è‡ªåŠ¨å¤„ç†ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„

---

## 3. Webview å’Œ Extension çš„è·¯å¾„åŒæ­¥

### 3.1 çŠ¶æ€åŒæ­¥æœºåˆ¶

Controller é€šè¿‡ `postStateToWebview()` å°†å·¥ä½œåŒºä¿¡æ¯åŒæ­¥åˆ° Webview:

```typescript
async getStateToPostToWebview(): Promise<ExtensionState> {
  return {
    // ä¼ é€’å·¥ä½œåŒºä¿¡æ¯åˆ° webview
    workspaceRoots: this.workspaceManager?.getRoots() ?? [],
    primaryRootIndex: this.workspaceManager?.getPrimaryIndex() ?? 0,
    isMultiRootWorkspace: (this.workspaceManager?.getRoots().length ?? 0) > 1,
    
    // ... å…¶ä»–çŠ¶æ€
    version,
    apiConfiguration,
    clineMessages,
    // ...
  }
}
```

### 3.2 Webview æ¥æ”¶çŠ¶æ€

Webview é€šè¿‡ `ExtensionStateContext` æ¥æ”¶å¹¶ç®¡ç†å·¥ä½œåŒºçŠ¶æ€:

```typescript
interface ExtensionState {
  workspaceRoots: WorkspaceRoot[]    // æ‰€æœ‰å·¥ä½œåŒºæ ¹ç›®å½•
  primaryRootIndex: number            // ä¸»å·¥ä½œåŒºç´¢å¼•
  isMultiRootWorkspace: boolean       // æ˜¯å¦å¤šå·¥ä½œåŒº
  // ... å…¶ä»–çŠ¶æ€
}
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
// åœ¨ React ç»„ä»¶ä¸­ä½¿ç”¨
const { workspaceRoots, primaryRootIndex } = useExtensionState()

// è·å–ä¸»å·¥ä½œåŒº
const primaryWorkspace = workspaceRoots[primaryRootIndex]

// æ˜¾ç¤ºå·¥ä½œåŒºä¿¡æ¯
<div>å½“å‰å·¥ä½œåŒº: {primaryWorkspace?.name || primaryWorkspace?.path}</div>
```

---

## 4. å…³é”®è®¾è®¡ç‰¹ç‚¹

### 4.1 è·¨å¹³å°è·¯å¾„å¤„ç†

#### Windows å¹³å°
- åŸç”Ÿä½¿ç”¨åæ–œæ  `\` ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦
- å±•ç¤ºæ—¶ç»Ÿä¸€è½¬æ¢ä¸ºæ­£æ–œæ  `/`
- è·¯å¾„æ¯”è¾ƒä¸åŒºåˆ†å¤§å°å†™

#### macOS/Linux å¹³å°
- åŸç”Ÿä½¿ç”¨æ­£æ–œæ  `/` ä½œä¸ºè·¯å¾„åˆ†éš”ç¬¦
- è·¯å¾„æ¯”è¾ƒåŒºåˆ†å¤§å°å†™

#### å®ç°ç»†èŠ‚

```typescript
// è·¯å¾„å±•ç¤ºè½¬æ¢
function toPosixPath(p: string) {
  // å¤„ç† Windows æ‰©å±•é•¿åº¦è·¯å¾„ (\\?\)
  const isExtendedLengthPath = p.startsWith("\\\\?\\")
  if (isExtendedLengthPath) {
    return p
  }
  return p.replace(/\\/g, "/")
}

// å®‰å…¨çš„è·¯å¾„æ¯”è¾ƒ
export function arePathsEqual(path1?: string, path2?: string): boolean {
  if (!path1 && !path2) return true
  if (!path1 || !path2) return false
  
  path1 = normalizePath(path1)
  path2 = normalizePath(path2)
  
  if (process.platform === "win32") {
    return path1.toLowerCase() === path2.toLowerCase()
  }
  return path1 === path2
}
```

### 4.2 å¤šå·¥ä½œåŒºæ”¯æŒ

#### åŠŸèƒ½ç‰¹æ€§

1. **å¤šæ ¹å·¥ä½œåŒº**: æ”¯æŒ VSCode å¤šæ ¹å·¥ä½œåŒºé…ç½®
2. **VCS æ£€æµ‹**: è‡ªåŠ¨æ£€æµ‹æ¯ä¸ªå·¥ä½œåŒºçš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
3. **Commit è¿½è¸ª**: è®°å½•æ¯ä¸ª Git å·¥ä½œåŒºçš„æœ€æ–° commit hash
4. **å·¥ä½œåŒºåˆ‡æ¢**: é€šè¿‡ `workspaceHint` åœ¨å¤šå·¥ä½œåŒºé—´åˆ‡æ¢

#### å·¥ä½œåŒºæç¤º (Workspace Hint)

```typescript
// æ–‡ä»¶è·¯å¾„æ ¼å¼: @workspace:name/path/to/file
// ä¾‹å¦‚: @workspace:frontend/src/App.tsx

// è§£æå·¥ä½œåŒºæç¤º
const parsed = parseWorkspaceInlinePath("@workspace:frontend/src/App.tsx")
// {
//   workspaceHint: "frontend",
//   path: "src/App.tsx"
// }
```

### 4.3 è·¯å¾„è§£æç­–ç•¥

æ ¹æ®æ–‡ä»¶ä½ç½®é‡‡ç”¨ä¸åŒçš„æ˜¾ç¤ºç­–ç•¥:

| æ–‡ä»¶ä½ç½® | æ˜¾ç¤ºæ–¹å¼ | ç¤ºä¾‹ |
|---------|---------|------|
| å·¥ä½œåŒºå†… | ç›¸å¯¹è·¯å¾„ | `src/file.ts` |
| å·¥ä½œåŒºå¤– | ç»å¯¹è·¯å¾„ | `/Users/user/other/file.ts` |
| å·¥ä½œåŒºæ ¹ | basename | `project-name` |
| Desktop (æ— å·¥ä½œåŒº) | ç»å¯¹è·¯å¾„ | `/Users/user/Desktop/file.ts` |

#### å®ç°é€»è¾‘

```typescript
export function getReadablePath(cwd: string, relPath?: string): string {
  const absolutePath = workspaceResolver.resolveWorkspacePath(cwd, relPath)
  
  // æ— å·¥ä½œåŒºæ—¶æ˜¾ç¤ºç»å¯¹è·¯å¾„
  if (arePathsEqual(cwd, getDesktopDir())) {
    return absolutePath.toPosix()
  }
  
  // å·¥ä½œåŒºæ ¹ç›®å½•æ˜¾ç¤º basename
  if (arePathsEqual(absolutePath, cwd)) {
    return workspaceResolver.getBasename(absolutePath).toPosix()
  }
  
  // å·¥ä½œåŒºå†…æ˜¾ç¤ºç›¸å¯¹è·¯å¾„
  const normalizedRelPath = path.relative(cwd, absolutePath)
  if (absolutePath.includes(cwd)) {
    return normalizedRelPath.toPosix()
  }
  
  // å·¥ä½œåŒºå¤–æ˜¾ç¤ºç»å¯¹è·¯å¾„
  return absolutePath.toPosix()
}
```

### 4.4 ç¯å¢ƒè¯¦æƒ…ä¼ é€’

é€šè¿‡ `buildWorkspacesJson()` ç”Ÿæˆå·¥ä½œåŒºé…ç½®,ä¼ é€’ç»™ AI:

```json
{
  "workspaces": {
    "/Users/user/project": {
      "hint": "project-name",
      "associatedRemoteUrls": [
        "git@github.com:user/project.git"
      ],
      "latestGitCommitHash": "abc123def456"
    },
    "/Users/user/another-project": {
      "hint": "another-project",
      "associatedRemoteUrls": [
        "https://github.com/user/another.git"
      ],
      "latestGitCommitHash": "789ghi012jkl"
    }
  }
}
```

#### ç”¨é€”

1. **ä¸Šä¸‹æ–‡æ„ŸçŸ¥**: AI äº†è§£å½“å‰å·¥ä½œåŒºç»“æ„
2. **å¤šå·¥ä½œåŒºè¯†åˆ«**: åŒºåˆ†ä¸åŒå·¥ä½œåŒºçš„æ–‡ä»¶
3. **ç‰ˆæœ¬è¿½è¸ª**: è®°å½• Git commit ä¿¡æ¯
4. **è¿œç¨‹ä»“åº“**: æä¾› Git è¿œç¨‹ä»“åº“ URL

---

## 5. æ•°æ®æµå‘

### 5.1 å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. è·å–å·¥ä½œåŒºè·¯å¾„                                              â”‚
â”‚    HostProvider.workspace.getWorkspacePaths()                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. åˆå§‹åŒ–å·¥ä½œåŒºç®¡ç†å™¨                                          â”‚
â”‚    getCwd() / setupWorkspaceManager()                        â”‚
â”‚    - detectWorkspaceRoots()                                  â”‚
â”‚    - WorkspaceRootManager.fromLegacyCwd()                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Controller å­˜å‚¨å·¥ä½œåŒºç®¡ç†å™¨                                 â”‚
â”‚    Controller.workspaceManager                               â”‚
â”‚    - getPrimaryRoot()                                        â”‚
â”‚    - getRoots()                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 4. ä¼ é€’ç»™ Task                                                â”‚
â”‚    new Task({ cwd, workspaceManager })                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 5. è·¯å¾„è§£æå’Œæ–‡ä»¶æ“ä½œ                                          â”‚
â”‚    workspaceResolver.resolveWorkspacePath()                  â”‚
â”‚    - ç›¸å¯¹è·¯å¾„ â†’ ç»å¯¹è·¯å¾„                                       â”‚
â”‚    - è·¨å·¥ä½œåŒºè·¯å¾„è§£æ                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. åŒæ­¥åˆ° Webview                                             â”‚
â”‚    postStateToWebview()                                      â”‚
â”‚    - workspaceRoots                                          â”‚
â”‚    - primaryRootIndex                                        â”‚
â”‚    - isMultiRootWorkspace                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 7. Webview æ˜¾ç¤º                                               â”‚
â”‚    ExtensionStateContext                                     â”‚
â”‚    - React ç»„ä»¶ä½¿ç”¨ useExtensionState()                       â”‚
â”‚    - æ˜¾ç¤ºå·¥ä½œåŒºä¿¡æ¯                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.2 å…³é”®ç»„ä»¶äº¤äº’

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HostProvider â”‚ æä¾› VSCode API è®¿é—®
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WorkspaceManager â”‚ ç®¡ç†å¤šä¸ªå·¥ä½œåŒº
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                 â”‚
       â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Controller â”‚â”€â”€â”€â–¶â”‚ Task         â”‚ æ‰§è¡Œæ–‡ä»¶æ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Webview          â”‚ æ˜¾ç¤ºå·¥ä½œåŒºä¿¡æ¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ€»ç»“

Cline çš„å·¥ä½œåŒºè·¯å¾„ç®¡ç†æ–¹æ¡ˆå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿:

### âœ… æ ¸å¿ƒä¼˜åŠ¿

1. **è·¨å¹³å°ä¸€è‡´æ€§**
   - ç»Ÿä¸€çš„è·¯å¾„å±•ç¤ºæ ¼å¼ (æ­£æ–œæ )
   - å¹³å°æ„ŸçŸ¥çš„è·¯å¾„æ¯”è¾ƒ
   - å¤„ç† Windows ç‰¹æ®Šè·¯å¾„æ ¼å¼

2. **å¤šå·¥ä½œåŒºæ”¯æŒ**
   - æ”¯æŒ VSCode å¤šæ ¹å·¥ä½œåŒº
   - è‡ªåŠ¨æ£€æµ‹ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
   - å·¥ä½œåŒºé—´æ™ºèƒ½åˆ‡æ¢

3. **Extension å’Œ Webview åŒæ­¥**
   - å®æ—¶çŠ¶æ€åŒæ­¥
   - ç±»å‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†
   - React Context é›†æˆ

4. **æ™ºèƒ½è·¯å¾„å¤„ç†**
   - ç›¸å¯¹è·¯å¾„å’Œç»å¯¹è·¯å¾„è‡ªåŠ¨é€‰æ‹©
   - å·¥ä½œåŒºæ„ŸçŸ¥çš„è·¯å¾„è§£æ
   - è·¨å·¥ä½œåŒºè·¯å¾„æ”¯æŒ

### ğŸ¯ é€‚ç”¨åœºæ™¯

- VSCode æ‰©å±•å¼€å‘
- å¤šå·¥ä½œåŒºé¡¹ç›®ç®¡ç†
- è·¨å¹³å°æ–‡ä»¶æ“ä½œ
- AI è¾…åŠ©ç¼–ç¨‹å·¥å…·

### ğŸ“š å‚è€ƒæ–‡ä»¶

- `src/utils/path.ts` - è·¯å¾„å·¥å…·å‡½æ•°
- `src/core/workspace/WorkspaceRootManager.ts` - å·¥ä½œåŒºç®¡ç†å™¨
- `src/core/controller/index.ts` - Controller å®ç°
- `src/shared/ExtensionMessage.ts` - çŠ¶æ€ç±»å‹å®šä¹‰
- `webview-ui/src/context/ExtensionStateContext.tsx` - Webview çŠ¶æ€ç®¡ç†
